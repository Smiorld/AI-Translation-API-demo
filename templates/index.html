<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>AI Translation Demo</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/3437/3437364.png" /> <!--free icon from flaticon-->
  </head>

<body class="min-h-screen bg-gradient-to-br from-indigo-50 via-white to-blue-50 flex items-center justify-center p-6">

  <div class="max-w-3xl w-full bg-white rounded-2xl shadow-lg p-8 border border-gray-100">
    <h1 class="text-3xl font-bold text-center text-indigo-700 mb-6">AI Translation Tool Demo</h1>
    <p class="text-center text-gray-500 mb-8">AI-powered translation & proofreading assistant</p>

    <div class="mb-6">
      <label for="apiToken" class="block text-gray-700 font-medium mb-2">API Token</label>
      <input type="password" id="apiToken"
        class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-indigo-400 focus:outline-none"
        placeholder="Enter your API token here..."  value="your_secret_token"/>
      <p class="text-sm text-gray-400 mt-1">Note: Your token will only be used locally in your browser.</p>
    </div>

    <div class="mb-4">
      <label for="inputText" class="block text-gray-700 font-medium mb-2">Your text</label>
      <textarea id="inputText" rows="5"
        class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-indigo-400 focus:outline-none"
        placeholder="Type or paste your text here..."></textarea>
    </div>

    <div class="flex items-center justify-between mb-6">
      <div class="flex items-center gap-2">
        <label for="targetLang" class="text-gray-700 font-medium">Target language:</label>
        <select id="targetLang"
          class="border rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-400 focus:outline-none">
          <option value="English">English</option>
          <option value="Chinese">Chinese</option>
          <option value="Japanese">Japanese</option>
          <option value="French">French</option>
        </select>
      </div>
      <button id="translateBtn"
        class="bg-indigo-600 hover:bg-indigo-700 transition text-white font-semibold px-5 py-2.5 rounded-lg shadow-md">
        Translate
      </button>
      <div id="serverStatus" class="text-sm text-gray-500 mb-4">
        Server status: <span id="statusText">Checking...</span>
      </div>
    </div>

    <div class="space-y-6">
      <div class="bg-indigo-50 rounded-lg p-4 border border-indigo-100">
        <h2 class="font-semibold text-indigo-700 mb-2 flex items-center gap-2">
          <span>Initial translation</span>
        </h2>
        <div id="translated" class="p-3 bg-white border rounded-lg min-h-[80px] text-gray-800"></div>
      </div>

      <div class="bg-green-50 rounded-lg p-4 border border-green-100">
        <h2 class="font-semibold text-green-700 mb-2 flex items-center gap-2">
          <span>AI proofread result</span>
        </h2>
        <div id="proofread" class="p-3 bg-white border rounded-lg min-h-[80px] text-gray-800"></div>
      </div>
    </div>

    <footer class="text-center text-gray-400 text-sm mt-8">
      © 2025 AI Translation demo. Powered by tailwindcss
    </footer>
  </div>

  <script>
    const btn = document.getElementById("translateBtn");
    const translatedDiv = document.getElementById("translated");
    const proofreadDiv = document.getElementById("proofread");

    btn.addEventListener("click", async () => {
      const text = document.getElementById("inputText").value.trim();
      const target = document.getElementById("targetLang").value;
      const token = document.getElementById("apiToken").value.trim();

      if (!text) {
        alert("Please enter some text first!");
        return;
      }
      if (!token) {
        alert("Please enter your API token first!");
        return;
      }

      translatedDiv.innerHTML = "<em class='text-gray-400'>Translating...</em>";
      proofreadDiv.innerHTML = "";

      try {
        const response = await fetch("/api/translate", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${token}`
          },
          body: JSON.stringify({ text, target })
        });

        const data = await response.json();
        translatedDiv.innerText = data.translated || "(no translation)";
        proofreadDiv.innerText = data.proofread || "(no proofreading result)";
      } catch (err) {
        translatedDiv.innerHTML = "<span class='text-red-500'>Translation failed.</span>";
        proofreadDiv.innerHTML = "";
        console.error(err);
      }
    });
    async function checkServer() {
      const statusText = document.getElementById("statusText");
      try {
        const response = await fetch("/api/status");
        if (response.ok) {
          statusText.innerText = "Online ✅";
          statusText.className = "text-green-600";
        } else {
          statusText.innerText = "Error ⚠️";
          statusText.className = "text-yellow-600";
        }
      } catch (err) {
        statusText.innerText = "Offline ❌";
        statusText.className = "text-red-600";
      }
    }

    // 页面加载时先检测一次
    checkServer();

    // 每 15 秒自动检测一次
    setInterval(checkServer, 15000);

  </script>
</body>

</html>
